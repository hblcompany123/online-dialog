<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DPMods Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#0f0f1a;
  color:#fff;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  background:#1c1c2b;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:350px;
  text-align:center;
}
input,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  border-radius:6px;
}
input{background:#2a2a3d;color:#fff}
button{background:#8e44ad;color:#fff;font-weight:bold}
.small{font-size:13px;opacity:.8;margin-top:10px}
.red{background:#c0392b}
</style>
</head>

<body>
<div class="box" id="app">Loading...</div>

<script>
const DATA_URL="https://raw.githubusercontent.com/hblcompany123/online-dialog/main/Key.json";

const app=document.getElementById("app");

function parseExpiry(exp,start){
  if(exp==="lifetime") return Infinity;
  if(exp.match(/^\d+[hdmy]$/)){
    let n=parseInt(exp);
    let t=exp.slice(-1);
    let ms={
      h:3600000,
      d:86400000,
      m:2592000000,
      y:31536000000
    }[t];
    return start+n*ms;
  }
  return new Date(exp).getTime();
}

function logout(){
  localStorage.removeItem("dp_key");
  localStorage.removeItem("dp_start");
  location.reload();
}

function showLogin(msg=""){
  app.innerHTML=`
    <h3>Enter Key</h3>
    <input id="key" placeholder="Enter key">
    <button onclick="login()">Login</button>
    <div class="small">${msg}</div>
  `;
}

async function login(){
  let k=document.getElementById("key").value.trim();
  let r=await fetch(DATA_URL,{cache:"no-store"});
  let j=await r.json();

  if(!j.keys[k]){ showLogin("Invalid key ❌"); return; }

  localStorage.setItem("dp_key",k);
  localStorage.setItem("dp_start",Date.now());
  location.reload();
}

async function main(){
  let r=await fetch(DATA_URL,{cache:"no-store"});
  let j=await r.json();

  let key=localStorage.getItem("dp_key");
  let start=parseInt(localStorage.getItem("dp_start"));

  if(!key){ showLogin(); return; }

  let info=j.keys[key];
  if(!info){ logout(); return; }

  let expiry=parseExpiry(info.expiry,start);
  if(Date.now()>expiry){
    logout();
    return;
  }

  app.innerHTML=`
    <h3>Access Granted ✅</h3>
    <p>${info.toast||""}</p>
    <div class="small">Key: ${key}</div>
    <div class="small">Expires: ${
      expiry===Infinity?"Never":new Date(expiry).toLocaleString()
    }</div>
    <button class="red" onclick="logout()">Delete / Logout</button>
  `;
}

main();
</script>
</body>
</html>
